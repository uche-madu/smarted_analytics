MERGE INTO {{ params.schema_name }}.{{ params.table_name }} AS target
USING @{{ params.schema_name }}.{{ params.stage_name }}/{{ params.file_name }} AS source
ON target.student_id = source.$1
   AND target.grade_level = source.$6
   AND target.term = source.$7
WHEN MATCHED THEN
   UPDATE SET
       target.name = source.$2,
       target.stream = source.$3,
       target.academic_year = source.$4,
       target.class_arm = source.$5,
       target.english_language_ca1 = source.$8,
       target.english_language_ca2 = source.$9,
       target.english_language_exam = source.$10,
       target.english_language_total = source.$11,
       target.english_language_attendance = source.$12,
       target.english_language_teacher_remarks = source.$13,
       target.mathematics_ca1 = source.$14,
       target.mathematics_ca2 = source.$15,
       target.mathematics_exam = source.$16,
       target.mathematics_total = source.$17,
       target.mathematics_attendance = source.$18,
       target.mathematics_teacher_remarks = source.$19,
       target.civic_education_ca1 = source.$20,
       target.civic_education_ca2 = source.$21,
       target.civic_education_exam = source.$22,
       target.civic_education_total = source.$23,
       target.civic_education_attendance = source.$24,
       target.civic_education_teacher_remarks = source.$25,
       target.biology_ca1 = source.$26,
       target.biology_ca2 = source.$27,
       target.biology_exam = source.$28,
       target.biology_total = source.$29,
       target.biology_attendance = source.$30,
       target.biology_teacher_remarks = source.$31,
       target.physics_ca1 = source.$32,
       target.physics_ca2 = source.$33,
       target.physics_exam = source.$34,
       target.physics_total = source.$35,
       target.physics_attendance = source.$36,
       target.physics_teacher_remarks = source.$37,
       target.chemistry_ca1 = source.$38,
       target.chemistry_ca2 = source.$39,
       target.chemistry_exam = source.$40,
       target.chemistry_total = source.$41,
       target.chemistry_attendance = source.$42,
       target.chemistry_teacher_remarks = source.$43,
       target.further_mathematics_ca1 = source.$44,
       target.further_mathematics_ca2 = source.$45,
       target.further_mathematics_exam = source.$46,
       target.further_mathematics_total = source.$47,
       target.further_mathematics_attendance = source.$48,
       target.further_mathematics_teacher_remarks = source.$49,
       target.health_education_ca1 = source.$50,
       target.health_education_ca2 = source.$51,
       target.health_education_exam = source.$52,
       target.health_education_total = source.$53,
       target.health_education_attendance = source.$54,
       target.health_education_teacher_remarks = source.$55,
       target.computer_science_ca1 = source.$56,
       target.computer_science_ca2 = source.$57,
       target.computer_science_exam = source.$58,
       target.computer_science_total = source.$59,
       target.computer_science_attendance = source.$60,
       target.computer_science_teacher_remarks = source.$61,
       target.technical_drawing_ca1 = source.$62,
       target.technical_drawing_ca2 = source.$63,
       target.technical_drawing_exam = source.$64,
       target.technical_drawing_total = source.$65,
       target.technical_drawing_attendance = source.$66,
       target.technical_drawing_teacher_remarks = source.$67,
       target.food_and_nutrition_ca1 = source.$68,
       target.food_and_nutrition_ca2 = source.$69,
       target.food_and_nutrition_exam = source.$70,
       target.food_and_nutrition_total = source.$71,
       target.food_and_nutrition_attendance = source.$72,
       target.food_and_nutrition_teacher_remarks = source.$73,
       target.agricultural_science_ca1 = source.$74,
       target.agricultural_science_ca2 = source.$75,
       target.agricultural_science_exam = source.$76,
       target.agricultural_science_total = source.$77,
       target.agricultural_science_attendance = source.$78,
       target.agricultural_science_teacher_remarks = source.$79,
       target.financial_accounting_ca1 = source.$80,
       target.financial_accounting_ca2 = source.$81,
       target.financial_accounting_exam = source.$82,
       target.financial_accounting_total = source.$83,
       target.financial_accounting_attendance = source.$84,
       target.financial_accounting_teacher_remarks = source.$85,
       target.book_keeping_ca1 = source.$86,
       target.book_keeping_ca2 = source.$87,
       target.book_keeping_exam = source.$88,
       target.book_keeping_total = source.$89,
       target.book_keeping_attendance = source.$90,
       target.book_keeping_teacher_remarks = source.$91,
       target.commerce_ca1 = source.$92,
       target.commerce_ca2 = source.$93,
       target.commerce_exam = source.$94,
       target.commerce_total = source.$95,
       target.commerce_attendance = source.$96,
       target.commerce_teacher_remarks = source.$97,
       target.data_processing_ca1 = source.$98,
       target.data_processing_ca2 = source.$99,
       target.data_processing_exam = source.$100,
       target.data_processing_total = source.$101,
       target.data_processing_attendance = source.$102,
       target.data_processing_teacher_remarks = source.$103,
       target.office_practice_ca1 = source.$104,
       target.office_practice_ca2 = source.$105,
       target.office_practice_exam = source.$106,
       target.office_practice_total = source.$107,
       target.office_practice_attendance = source.$108,
       target.office_practice_teacher_remarks = source.$109,
       target.typewriting_ca1 = source.$110,
       target.typewriting_ca2 = source.$111,
       target.typewriting_exam = source.$112,
       target.typewriting_total = source.$113,
       target.typewriting_attendance = source.$114,
       target.typewriting_teacher_remarks = source.$115,
       target.economics_ca1 = source.$116,
       target.economics_ca2 = source.$117,
       target.economics_exam = source.$118,
       target.economics_total = source.$119,
       target.economics_attendance = source.$120,
       target.economics_teacher_remarks = source.$121,
       target.government_ca1 = source.$122,
       target.government_ca2 = source.$123,
       target.government_exam = source.$124,
       target.government_total = source.$125,
       target.government_attendance = source.$126,
       target.government_teacher_remarks = source.$127,
       target.literature_in_english_ca1 = source.$128,
       target.literature_in_english_ca2 = source.$129,
       target.literature_in_english_exam = source.$130,
       target.literature_in_english_total = source.$131,
       target.literature_in_english_attendance = source.$132,
       target.literature_in_english_teacher_remarks = source.$133,
       target.christian_religion_knowledge_ca1 = source.$134,
       target.christian_religion_knowledge_ca2 = source.$135,
       target.christian_religion_knowledge_exam = source.$136,
       target.christian_religion_knowledge_total = source.$137,
       target.christian_religion_knowledge_attendance = source.$138,
       target.christian_religion_knowledge_teacher_remarks = source.$139,
       target.geography_ca1 = source.$140,
       target.geography_ca2 = source.$141,
       target.geography_exam = source.$142,
       target.geography_total = source.$143,
       target.geography_attendance = source.$144,
       target.geography_teacher_remarks = source.$145,
       target.fine_art_ca1 = source.$146,
       target.fine_art_ca2 = source.$147,
       target.fine_art_exam = source.$148,
       target.fine_art_total = source.$149,
       target.fine_art_attendance = source.$150,
       target.fine_art_teacher_remarks = source.$151
       target.updated_at = CURRENT_TIMESTAMP  -- Updates the timestamp for modifications

WHEN NOT MATCHED THEN
   INSERT (student_id, name, stream, academic_year, class_arm, grade_level, term, 
           english_language_ca1, english_language_ca2, english_language_exam, english_language_total, 
           english_language_attendance, english_language_teacher_remarks, 
           mathematics_ca1, mathematics_ca2, mathematics_exam, mathematics_total, 
           mathematics_attendance, mathematics_teacher_remarks, 
           civic_education_ca1, civic_education_ca2, civic_education_exam, civic_education_total, 
           civic_education_attendance, civic_education_teacher_remarks, 
           biology_ca1, biology_ca2, biology_exam, biology_total, 
           biology_attendance, biology_teacher_remarks, 
           physics_ca1, physics_ca2, physics_exam, physics_total, 
           physics_attendance, physics_teacher_remarks, 
           chemistry_ca1, chemistry_ca2, chemistry_exam, chemistry_total, 
           chemistry_attendance, chemistry_teacher_remarks, 
           further_mathematics_ca1, further_mathematics_ca2, further_mathematics_exam, further_mathematics_total, 
           further_mathematics_attendance, further_mathematics_teacher_remarks, 
           health_education_ca1, health_education_ca2, health_education_exam, health_education_total, 
           health_education_attendance, health_education_teacher_remarks, 
           computer_science_ca1, computer_science_ca2, computer_science_exam, computer_science_total, 
           computer_science_attendance, computer_science_teacher_remarks, 
           technical_drawing_ca1, technical_drawing_ca2, technical_drawing_exam, technical_drawing_total, 
           technical_drawing_attendance, technical_drawing_teacher_remarks, 
           food_and_nutrition_ca1, food_and_nutrition_ca2, food_and_nutrition_exam, food_and_nutrition_total, 
           food_and_nutrition_attendance, food_and_nutrition_teacher_remarks, 
           agricultural_science_ca1, agricultural_science_ca2, agricultural_science_exam, agricultural_science_total, 
           agricultural_science_attendance, agricultural_science_teacher_remarks, 
           financial_accounting_ca1, financial_accounting_ca2, financial_accounting_exam, financial_accounting_total, 
           financial_accounting_attendance, financial_accounting_teacher_remarks, 
           book_keeping_ca1, book_keeping_ca2, book_keeping_exam, book_keeping_total, 
           book_keeping_attendance, book_keeping_teacher_remarks, 
           commerce_ca1, commerce_ca2, commerce_exam, commerce_total, 
           commerce_attendance, commerce_teacher_remarks, 
           data_processing_ca1, data_processing_ca2, data_processing_exam, data_processing_total, 
           data_processing_attendance, data_processing_teacher_remarks, 
           office_practice_ca1, office_practice_ca2, office_practice_exam, office_practice_total, 
           office_practice_attendance, office_practice_teacher_remarks, 
           typewriting_ca1, typewriting_ca2, typewriting_exam, typewriting_total, 
           typewriting_attendance, typewriting_teacher_remarks, 
           economics_ca1, economics_ca2, economics_exam, economics_total, 
           economics_attendance, economics_teacher_remarks, 
           government_ca1, government_ca2, government_exam, government_total, 
           government_attendance, government_teacher_remarks, 
           literature_in_english_ca1, literature_in_english_ca2, literature_in_english_exam, literature_in_english_total, 
           literature_in_english_attendance, literature_in_english_teacher_remarks, 
           christian_religion_knowledge_ca1, christian_religion_knowledge_ca2, christian_religion_knowledge_exam, christian_religion_knowledge_total, 
           christian_religion_knowledge_attendance, christian_religion_knowledge_teacher_remarks, 
           geography_ca1, geography_ca2, geography_exam, geography_total, 
           geography_attendance, geography_teacher_remarks, 
           fine_art_ca1, fine_art_ca2, fine_art_exam, fine_art_total, 
           fine_art_attendance, fine_art_teacher_remarks, created_at, updated_at)
   VALUES (source.$1, source.$2, source.$3, source.$4, source.$5, source.$6, source.$7, 
           source.$8, source.$9, source.$10, source.$11, source.$12, source.$13, 
           source.$14, source.$15, source.$16, source.$17, source.$18, source.$19, 
           source.$20, source.$21, source.$22, source.$23, source.$24, source.$25, 
           source.$26, source.$27, source.$28, source.$29, source.$30, source.$31, 
           source.$32, source.$33, source.$34, source.$35, source.$36, source.$37, 
           source.$38, source.$39, source.$40, source.$41, source.$42, source.$43, 
           source.$44, source.$45, source.$46, source.$47, source.$48, source.$49, 
           source.$50, source.$51, source.$52, source.$53, source.$54, source.$55, 
           source.$56, source.$57, source.$58, source.$59, source.$60, source.$61, 
           source.$62, source.$63, source.$64, source.$65, source.$66, source.$67, 
           source.$68, source.$69, source.$70, source.$71, source.$72, source.$73, 
           source.$74, source.$75, source.$76, source.$77, source.$78, source.$79, 
           source.$80, source.$81, source.$82, source.$83, source.$84, source.$85, 
           source.$86, source.$87, source.$88, source.$89, source.$90, source.$91, 
           source.$92, source.$93, source.$94, source.$95, source.$96, source.$97, 
           source.$98, source.$99, source.$100, source.$101, source.$102, source.$103, 
           source.$104, source.$105, source.$106, source.$107, source.$108, source.$109, 
           source.$110, source.$111, source.$112, source.$113, source.$114, source.$115, 
           source.$116, source.$117, source.$118, source.$119, source.$120, source.$121, 
           source.$122, source.$123, source.$124, source.$125, source.$126, source.$127, 
           source.$128, source.$129, source.$130, source.$131, source.$132, source.$133, 
           source.$134, source.$135, source.$136, source.$137, source.$138, source.$139, 
           source.$140, source.$141, source.$142, source.$143, source.$144, source.$145, 
           source.$146, source.$147, source.$148, source.$149, source.$150, source.$151,
           CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);


